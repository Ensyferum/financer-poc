{
  "version": "1.0.0",
  "description": "Create initial MongoDB collections and indexes",
  "author": "Financer Development Team (Python Migration)",
  "date": "2025-11-06",
  
  "collections": [
    {
      "name": "transactions",
      "options": {
        "validator": {
          "$jsonSchema": {
            "bsonType": "object",
            "required": ["transaction_id", "account_id", "amount", "type", "status", "created_at"],
            "properties": {
              "transaction_id": {
                "bsonType": "string",
                "description": "Unique transaction identifier"
              },
              "account_id": {
                "bsonType": "string", 
                "description": "Reference to account UUID"
              },
              "amount": {
                "bsonType": "decimal",
                "description": "Transaction amount"
              },
              "type": {
                "bsonType": "string",
                "enum": ["DEBIT", "CREDIT", "TRANSFER", "FEE"],
                "description": "Transaction type"
              },
              "status": {
                "bsonType": "string",
                "enum": ["PENDING", "COMPLETED", "FAILED", "CANCELLED"],
                "description": "Transaction status"
              },
              "description": {
                "bsonType": "string",
                "description": "Transaction description"
              },
              "metadata": {
                "bsonType": "object",
                "description": "Additional transaction metadata"
              },
              "created_at": {
                "bsonType": "date",
                "description": "Transaction creation timestamp"
              },
              "completed_at": {
                "bsonType": ["date", "null"],
                "description": "Transaction completion timestamp"
              }
            }
          }
        }
      }
    },
    {
      "name": "transaction_events",
      "options": {
        "capped": true,
        "size": 52428800,
        "max": 100000
      }
    },
    {
      "name": "account_preferences",
      "options": {}
    }
  ],
  
  "indexes": [
    {
      "collection": "transactions",
      "index": {"transaction_id": 1},
      "options": {"unique": true}
    },
    {
      "collection": "transactions", 
      "index": {"account_id": 1, "created_at": -1},
      "options": {"name": "account_transactions_idx"}
    },
    {
      "collection": "transactions",
      "index": {"status": 1, "type": 1},
      "options": {"name": "status_type_idx"}
    },
    {
      "collection": "transactions",
      "index": {"created_at": 1},
      "options": {"expireAfterSeconds": 31536000}
    },
    {
      "collection": "transaction_events",
      "index": {"transaction_id": 1, "timestamp": -1},
      "options": {"name": "event_lookup_idx"}
    },
    {
      "collection": "account_preferences",
      "index": {"account_id": 1},
      "options": {"unique": true}
    }
  ],
  
  "data": [
    {
      "collection": "account_preferences",
      "type": "insert",
      "documents": [
        {
          "account_id": "ACC-001",
          "preferences": {
            "notifications": {
              "email": true,
              "sms": false,
              "push": true
            },
            "limits": {
              "daily_transaction_limit": 5000.00,
              "monthly_transaction_limit": 50000.00
            },
            "features": {
              "overdraft_protection": true,
              "auto_save": false
            }
          },
          "created_at": "2025-11-06T20:00:00Z",
          "updated_at": "2025-11-06T20:00:00Z"
        },
        {
          "account_id": "ACC-002", 
          "preferences": {
            "notifications": {
              "email": true,
              "sms": true,
              "push": true
            },
            "limits": {
              "daily_transaction_limit": 2000.00,
              "monthly_transaction_limit": 20000.00
            },
            "features": {
              "overdraft_protection": false,
              "auto_save": true
            }
          },
          "created_at": "2025-11-06T20:00:00Z",
          "updated_at": "2025-11-06T20:00:00Z"
        }
      ]
    },
    {
      "collection": "transaction_events",
      "type": "insert",
      "documents": [
        {
          "transaction_id": "TXN-INIT-001",
          "event_type": "MIGRATION_INIT",
          "event_data": {
            "migration_version": "1.0.0",
            "migration_tool": "python-migration",
            "timestamp": "2025-11-06T20:00:00Z"
          },
          "timestamp": "2025-11-06T20:00:00Z"
        }
      ]
    }
  ]
}